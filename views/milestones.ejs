<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milestones | Ella Rises</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Nunito+Sans:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --clr-pink-dark:#ce325b;
      --clr-white:#fff;
      --clr-gray:#f5f5f5;
      --clr-charcoal:#3a3f3b;
      --clr-peach:#f9f5ea;
    }
    body{font-family:'Nunito Sans',sans-serif;background:var(--clr-gray);color:var(--clr-charcoal);margin:0}
    .wrap{max-width:900px;margin:2rem auto;padding:2rem;background:var(--clr-white);border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    h1{font-family:'Montserrat',sans-serif;color:var(--clr-pink-dark);margin:0 0 1rem}
    h2{font-family:'Montserrat',sans-serif;color:var(--clr-pink-dark);margin-top:2rem}
    form{margin-top:1rem}
    .row{display:flex;gap:1rem;flex-wrap:wrap}
    .field{flex:1 1 100%}
    label{display:block;font-weight:700;margin:.25rem 0 .35rem}
    input,select,button,textarea{
      width:100%;padding:.75rem .9rem;border:1px solid #e6e6e6;border-radius:10px;font-size:1rem;background:#fff
    }
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--clr-pink-dark);box-shadow:0 0 0 3px rgba(206,50,91,.12)}
    .actions{display:flex;gap:.75rem;margin-top:1rem}
    .btn-primary{background:var(--clr-pink-dark);color:#fff;border:none;font-weight:700;cursor:pointer}
    .btn-primary:hover{background:linear-gradient(135deg,#ce325b,#f4b092);transform:translateY(-1px)}
    .btn-link{background:transparent;border:1px solid #ddd;text-decoration:none;text-align:center;color:var(--clr-charcoal)}
    table{width:100%;margin-top:2rem;border-collapse:collapse}
    th,td{padding:.75rem;border-bottom:1px solid #eee;text-align:left}
    th{background:var(--clr-peach);color:var(--clr-charcoal);font-weight:700}
    tr:hover{background:#fafafa}
    .no-data{text-align:center;color:#888;font-style:italic;margin-top:1rem}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Milestones</h1>

    <% if (user.role.toLowerCase().startsWith('a')) { %>
      <p>Select a participant, enter a milestone title, and optionally choose a completion date.</p>
      <form action="/milestones/add" method="POST"> 
        <div class="field">
          <label for="user_id">Participant</label>
          <select id="user_id" name="user_id" required>
            <option value="">— Select a participant —</option>
            
            <% participants.forEach(u => { %>
              <option value="<%= u.user_id %>"><%= u.last_name %>, <%= u.first_name %></option>
            <% }) %>
            
          </select>
        </div>
        <div class="field">
          <label for="title">Milestone Title</label>
          <input id="title" name="title" type="text" placeholder="e.g., Completed STEM Workshop" required />
        </div>
        <div class="row">
          <div class="field">
            <label for="milestone_date">Completion Date (optional)</label>
            <input id="milestone_date" name="milestone_date" type="date" />
          </div>
        </div>
        <div class="actions">
          <button class="btn-primary" type="submit">Save Milestone</button>
          <a class="btn-link" href="/milestones">Cancel</a>
        </div>
      </form>
    <% } %>

    <h2>Completed Milestones</h2>
<% if (usersWithMilestones && usersWithMilestones.length > 0) { %>
  <table>
    <thead>
      <tr>
        <th>User ID</th>
        <th>Participant</th>
        <th>Milestones</th>
      </tr>
    </thead>
    <tbody>
      <% usersWithMilestones.forEach(u => { %>
        <tr>
          <td><%= u.user_id %></td>
          <td><%= u.last_name %>, <%= u.first_name %></td>
          <td>
            <ul style="margin:0; padding-left:1.2rem;">
              <% u.milestones.forEach(m => { %>
                <li>
                  <%= m.title %>
                  <% if (m.date) { %>
                    (<%= new Date(m.date).toLocaleDateString() %>)
                  <% } %>
                </li>
              <% }) %>
            </ul>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } else { %>
  <p class="no-data">No milestones found.</p>
<% } %>

</body>
</html>
