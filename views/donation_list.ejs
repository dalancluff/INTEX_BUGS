<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Donations | Ella Rises</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Nunito+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --clr-peach-light:#F9F5EA;
      --clr-pink-soft:#FFD8D1; --clr-pink:#F9AFB1; --clr-pink-dark:#CE325B;
      --clr-sage:#9AB59D; --clr-charcoal:#3A3F3B; --clr-coral:#F4B092; --clr-blue-muted:#99B7C6;
      --clr-purple:#978EC4; --clr-white:#fff; --clr-gray-light:#f5f5f5;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Nunito Sans',sans-serif;background:var(--clr-gray-light);color:var(--clr-charcoal);min-height:100vh}

    /* Navbar */
    .navbar{background:var(--clr-white);padding:1rem 2rem;box-shadow:0 2px 10px rgba(0,0,0,.1);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10}
    .logo{font-family:'Montserrat',sans-serif;font-size:1.5rem;font-weight:700;color:var(--clr-pink-dark);text-decoration:none}
    .nav-links{list-style:none;display:flex;gap:1.5rem}
    .nav-links a{text-decoration:none;color:var(--clr-charcoal);font-weight:600}
    .nav-links a:hover{color:var(--clr-pink-dark)}

    /* Header */
    .page-header{max-width:1000px;margin:3rem auto 2rem;background:linear-gradient(135deg,var(--clr-pink-soft) 0%,var(--clr-peach-light) 100%);
    padding:2.5rem 1.5rem;border-radius:20px;box-shadow:0 4px 15px rgba(0,0,0,.08);text-align:center}
    .page-header h1{font-family:'Montserrat',sans-serif;font-size:2.4rem;color:var(--clr-pink-dark);margin-bottom:.6rem}
    .page-header p{font-size:1.1rem;opacity:.9}

    /* Filters / Search Bar */
    .filters{max-width:1000px;margin:0 auto 1rem;display:flex;gap:.75rem;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .filters form{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}
    
    /* Input Styling */
    .input{
        padding:.65rem .9rem;
        border-radius:999px; /* Rounded matches buttons */
        border:1px solid #e0e0e0;
        background:#fff;
        min-width:280px; 
        font-family: inherit;
        height: 42px; /* Fixed height for alignment */
    }
    
    /* Button Styling */
    .btn{
        background:var(--clr-pink-dark);
        color:#fff;
        border:none;
        border-radius:999px;
        padding: 0 1.2rem; /* Remove vertical padding, rely on height */
        height: 42px;      /* Match Input Height */
        line-height: 42px; /* Vertically Center Text */
        font-weight:700;
        cursor:pointer;
        text-decoration:none;
        display:inline-block;
        font-size: 1rem;
        white-space: nowrap;
    }
    .btn:hover{background:#b72b51}

    /* Table */
    .table-wrap{max-width:1000px;margin:1.5rem auto 3rem;background:linear-gradient(135deg,var(--clr-peach-light) 0%,var(--clr-white) 100%);
    border-radius:20px;box-shadow:0 4px 20px rgba(0,0,0,.08);padding:2rem;overflow-x:auto}
    table{width:100%;border-collapse:collapse}
    thead{background:var(--clr-pink);color:var(--clr-charcoal)}
    th,td{padding:1rem;text-align:left;border-bottom:1px solid rgba(0,0,0,.05)}
    th{font-family:'Montserrat',sans-serif;font-weight:600}
    tr:hover{background:var(--clr-pink-soft);transition:background .3s}

    @media (max-width:768px){
      .page-header h1{font-size:1.9rem}
      .table-wrap{padding:1rem}
      th,td{padding:.8rem}
      .filters { justify-content: center; }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="/" class="logo">Ella Rises</a>
    <ul class="nav-links">
      <li><a href="/dashboard">Dashboard</a></li>
      <li><a href="/participants">Participants</a></li>
      <li><a href="/events">Events</a></li>
      <li><a href="/donation_list" style="color: var(--clr-pink-dark);">Donations</a></li>
      <li><a href="/logout">Logout</a></li>
    </ul>
  </nav>

  <section class="page-header">
    <h1>Donations</h1>
    <p>Manage and track all incoming donations.</p>
  </section>

  <div class="filters">
    <form method="get" action="/donation_list">
      <input class="input" type="text" name="search" placeholder="Search donor, amount, date..." value="<%= searchTerm %>">
      
      <button class="btn" type="submit">Search</button>
      
      <% if (searchTerm) { %>
        <a href="/donation_list" class="btn" style="background-color: var(--clr-charcoal);">Clear</a>
      <% } %>
    </form>

    <% if (user.role === 'admin') { %>
      <a href="/donations/add" class="btn" style="background-color: var(--clr-sage);">
        <i class="fa-solid fa-plus"></i> Add Donation
      </a>
    <% } else { %>
      <a href="https://givebutter.com/EllaRises" target="_blank" class="btn" style="background-color: var(--clr-pink-dark);">
        <i class="fa-solid fa-heart"></i> Donate Now
      </a>
    <% } %> </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Donor Name</th>
          <th>Amount</th>
          <th>Date</th>
          <% if (user.role === 'admin') { %>
            <th style="text-align: right;">Actions</th>
          <% } %>
        </tr>
      </thead>
      <tbody>
        <% if (donations.length === 0) { %>
            <tr><td colspan="<%= user.role === 'admin' ? 4 : 3 %>" style="text-align:center; padding: 2rem;">No donations found.</td></tr>
        <% } %>

        <% donations.forEach(donation => { %>
          <tr>
            <td><%= donation.donor_name %></td>
            
            <td>$<%= Number(donation.amount).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></td>
            
            <td>
              <% if (donation.date) { %>
                <%= new Date(donation.date).toLocaleDateString() %>
              <% } else { %>
                <span style="opacity: 0.5;">—</span> 
              <% } %>
            </td>

            <% if (user.role === 'admin') { %>
              <td style="text-align: right; min-width: 140px;">
                <div style="display: flex; gap: 8px; justify-content: flex-end;">
                  <a href="/donations/edit/<%= donation.donation_id %>" class="btn" style="padding: 0 1rem; font-size: 0.8rem; background-color: var(--clr-blue-muted); height: 32px; line-height: 32px;">Edit</a>
                  
                  <form action="/donations/delete/<%= donation.donation_id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this donation?');">
                    <button type="submit" class="btn" style="padding: 0 1rem; font-size: 0.8rem; background-color: var(--clr-charcoal); height: 32px; line-height: 32px;">Delete</button>
                  </form>
                </div>
              </td>
            <% } %>

          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div style="text-align:center;margin-bottom:3rem;">
    <a class="btn" href="/dashboard">← Back to Dashboard</a>
  </div>

</body>
</html>
